;;-*- mode: nendo; syntax: scheme -*-;;
;; test for sekka jisyo library

(use nendo.test)
(load "./lib/convert-jisyo.nnd")

(define debug-print-length 2000)

(test-start "jisyo converter")

;;===================================================================

;;-------------------------------------------------------------------
(test-section "SKK2Sekka Convert")

(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りなし1)"
       '(("ai" . "Cあい") ("あい" . "/愛/哀/相/挨"))
       (expand-okuri-nashi-entry "あい" "/愛/哀/相/挨"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りなし2)"
       '(("unn" . "Cうん") ("un" . "Cうん") ("uq" . "Cうん") ("うん" . "/云/運/雲"))
       (expand-okuri-nashi-entry "うん" "/云/運/雲"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りなし3)"
       '(("ko-hi-" . "Cこーひー") ("ko-hi^" . "Cこーひー") ("ko-hi:" . "Cこーひー") ("ko^hi-" . "Cこーひー") ("ko^hi^" . "Cこーひー") ("ko^hi:" . "Cこーひー") ("ko:hi-" . "Cこーひー") ("ko:hi^" . "Cこーひー") ("ko:hi:" . "Cこーひー") ("こーひー" . "/コーヒー"))
       (expand-okuri-nashi-entry "こーひー" "/コーヒー"))

(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りあり1)"
       '(("shiroI" . "Cしろi") ("siroI" . "Cしろi") ("しろi" . "/白"))
       (expand-okuri-ari-entry   "しろ" "i" "/白"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りあり2)"
       '(("kaK" . "Cかk") ("かk" . "/書/掛/欠/架/駆/懸"))
       (expand-okuri-ari-entry   "か" "k" "/書/掛/欠/架/駆/懸"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りあり3)"
       '(("kaT" . "Cかt") ("かt" . "/勝/買/飼/刈;(crop)草を刈る"))
       (expand-okuri-ari-entry   "か" "t" "/勝/買/飼/刈;(crop)草を刈る"))

(let1 _input (StringIO.new
              (string-join
               '(
                 ";; コメント"
                 ";; コメント コメント コメント コメント コメント "
                 "しろi /白/"
                 "あい /愛/哀/相/挨/"
                 "Greek /Α/Β/Γ/Δ/Ε/Ζ/Η/Θ/Ι/Κ/Λ/Μ/Ν/Ξ/Ο/Π/Ρ/Σ/Τ/Υ/Φ/Χ/Ψ/Ω/"
                 ">あん /案/"
                 ">やすi /易/"
                 "! /！/感嘆符/"
                 "? /？/"
                 "こーひー /コーヒー/"
                 )
               "\n"))
  (test* "convert SKK file to SEKKA jisyo file. (1)"
         '("shiroI Cしろi" "siroI Cしろi" "しろi /白" "ai Cあい" "あい /愛/哀/相/挨" "Greek /Α/Β/Γ/Δ/Ε/Ζ/Η/Θ/Ι/Κ/Λ/Μ/Ν/Ξ/Ο/Π/Ρ/Σ/Τ/Υ/Φ/Χ/Ψ/Ω" ">ann C>あん" ">an C>あん" ">aq C>あん" ">あん /案" ">yasuI C>やすi" ">やすi /易" "! /！/感嘆符" "? /？" "ko-hi- Cこーひー" "ko-hi^ Cこーひー" "ko-hi: Cこーひー" "ko^hi- Cこーひー" "ko^hi^ Cこーひー" "ko^hi: Cこーひー" "ko:hi- Cこーひー" "ko:hi^ Cこーひー" "ko:hi: Cこーひー" "こーひー /コーヒー")
         (convert-skk-jisyo-f _input)))

;;===================================================================
(test-end)
