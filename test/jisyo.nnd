;;-*- mode: nendo; syntax: scheme -*-;;
;; test for sekka jisyo library

(use nendo.test)
(load "./lib/convert-jisyo.nnd")

(define debug-print-length 10000)

(test-start "jisyo converter")

;;===================================================================

;;-------------------------------------------------------------------
(test-section "SKK2Sekka Convert")

(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りなし1)"
       '(("ai" . "Cあい") ("あい" . "/愛/哀/相/挨"))
       (expand-okuri-nashi-entry "あい" "/愛/哀/相/挨"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りなし2)"
       '(("un" . "Cうん") ("unn" . "Cうん") ("uq" . "Cうん") ("うん" . "/云/運/雲"))
       (expand-okuri-nashi-entry "うん" "/云/運/雲"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りなし3)"
       '(("ko-hi-" . "Cこーひー") ("ko-hi:" . "Cこーひー") ("ko-hi^" . "Cこーひー") ("ko:hi-" . "Cこーひー") ("ko:hi:" . "Cこーひー") ("ko:hi^" . "Cこーひー") ("ko^hi-" . "Cこーひー") ("ko^hi:" . "Cこーひー") ("ko^hi^" . "Cこーひー") ("こーひー" . "/コーヒー"))
       (expand-okuri-nashi-entry "こーひー" "/コーヒー"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りなし4)"
       '(("ka;ko" . "Cかっこ") ("ka@ko" . "Cかっこ") ("kakko" . "Cかっこ") ("かっこ" . "/確固/括弧/各個/各戸/確乎/羯鼓;雅楽の打楽器/格好/『/』;二重鉤括弧"))
       (expand-okuri-nashi-entry "かっこ" "/確固/括弧/各個/各戸/確乎/羯鼓;雅楽の打楽器/格好/『/』;二重鉤括弧"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りなし5)"
       #f
       (expand-okuri-nashi-entry "すたんでぃんぐおべーしょん" "/スタンディングオベーション"))

(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りあり1)"
       '(("shiroI" . "Cしろi") ("siroI" . "Cしろi") ("しろi" . "/白"))
       (expand-okuri-ari-entry   "しろ" "i" "/白"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りあり2)"
       '(("kaK" . "Cかk") ("かk" . "/書/掛/欠/架/駆/懸"))
       (expand-okuri-ari-entry   "か" "k" "/書/掛/欠/架/駆/懸"))
(test* "expanding SKK(1) entry to SEKKA(n) entry. (送りあり3)"
       '(("kaT" . "Cかt") ("かt" . "/勝/買/飼/刈;(crop)草を刈る/狩;(hunt)兎を狩る/且;-つて/駆;バイクを駆って/交;飛び交って/克;(overcome) 逆境に克つ/糅;-てて加えて/苅;「刈」の異体字/驅;「駆」の旧字/支;ささえる/上;(尺八の)カリ⇔減り(メリ)/搗") ("ka`" . "Cか`") ("か`" . "/勝/買/飼/刈;(crop)草を刈る/狩;(hunt)兎を狩る/且;-つて/駆;バイクを駆って/交;飛び交って/克;(overcome) 逆境に克つ/糅;-てて加えて/苅;「刈」の異体字/驅;「駆」の旧字/支;ささえる/上;(尺八の)カリ⇔減り(メリ)/搗") ("ka+" . "Cか+") ("か+" . "/勝/買/飼/刈;(crop)草を刈る/狩;(hunt)兎を狩る/且;-つて/駆;バイクを駆って/交;飛び交って/克;(overcome) 逆境に克つ/糅;-てて加えて/苅;「刈」の異体字/驅;「駆」の旧字/支;ささえる/上;(尺八の)カリ⇔減り(メリ)/搗"))
       (expand-okuri-ari-entry   "か" "t" "/勝/買/飼/刈;(crop)草を刈る/狩;(hunt)兎を狩る/且;-つて/駆;バイクを駆って/交;飛び交って/克;(overcome) 逆境に克つ/糅;-てて加えて/苅;「刈」の異体字/驅;「駆」の旧字/支;ささえる/上;(尺八の)カリ⇔減り(メリ)/搗"))

(let1 _input (StringIO.new
              (string-join
               '(
                 ";; コメント"
                 ";; コメント コメント コメント コメント コメント "
                 "しろi /白/"
                 "あい /愛/哀/相/挨/"
                 "Greek /Α/Β/Γ/Δ/Ε/Ζ/Η/Θ/Ι/Κ/Λ/Μ/Ν/Ξ/Ο/Π/Ρ/Σ/Τ/Υ/Φ/Χ/Ψ/Ω/"
                 ">あん /案/"
                 ">やすi /易/"
                 "! /！/感嘆符/"
                 "? /？/"
                 "こーひー /コーヒー/"
                 )
               "\n"))
  (test* "convert SKK file to SEKKA jisyo file. (1)"
         '("shiroI Cしろi" "siroI Cしろi" "しろi /白" "ai Cあい" "あい /愛/哀/相/挨" "Greek /Α/Β/Γ/Δ/Ε/Ζ/Η/Θ/Ι/Κ/Λ/Μ/Ν/Ξ/Ο/Π/Ρ/Σ/Τ/Υ/Φ/Χ/Ψ/Ω" ">an C>あん" ">ann C>あん" ">aq C>あん" ">あん /案" ">yasuI C>やすi" ">やすi /易" "! /！/感嘆符" "? /？" "ko-hi- Cこーひー" "ko-hi: Cこーひー" "ko-hi^ Cこーひー" "ko:hi- Cこーひー" "ko:hi: Cこーひー" "ko:hi^ Cこーひー" "ko^hi- Cこーひー" "ko^hi: Cこーひー" "ko^hi^ Cこーひー" "こーひー /コーヒー")
         (convert-skk-jisyo-f _input)))

;;===================================================================
(test-end)
