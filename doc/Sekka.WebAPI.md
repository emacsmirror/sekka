# Sekka Web APIの解説

このページでは、Sekka Web API仕様について解説します。
sekka-serverは、ローマ字から仮名漢字への変換をREST APIとして提供しています。
Sekka用クライアントソフトウェアを開発される方は活用してください。

# Sekka設計方針
ローマ字から仮名漢字への変換を全てサーバー側で行うという設計になっています。
従って、クライアント側にローマ字テーブルさえ持つ必要はありません。
アルファベットさえ入力できる環境であれば、ローマ字仮名漢字変換が可能です。

ユーザー学習辞書はサーバー側に保存します。従って、全てのリクエストにユーザーIDを指定する必要があります。

# sekka-server仕様
## アクセスURL
以下のルールでアクセスします。メソッドはPOSTを使用してください。
! http://ホスト名:12929/機能

例:
! http://localhost:12929/henkan

## パラメータ
パラメータはPOSTのBodyで渡します。
パラメータ値は全てURI Encodeしてください。

以下に、curlでsekka-serverにアクセスする完全なコマンドラインサンプルを示します。(実際にsekka.elからリクエストされるコマンドです)
見易いように途中で改行を入れていますが実際は1行です。
!curl --silent --show-error  --max-time 10  --insecure
!  --header 'Content-Type: application/x-www-form-urlencoded'
!    http://localhost:12929/henkan
!  --data 'format=sexp'
!  --data 'yomi=Kanjihenkan'
!  --data 'limit=0'
!  --data 'method=normal'
!  --data 'userid=kiyoka' 

仮にvim用スクリプトを作る場合もsekka.el同様、上記のコマンドがそのまま使用できるでしょう。

## 全機能共通の必須パラメータ

### userid
ユーザーIDを指定します。
Emacs用クライアントではログインIDを渡す実装になっています。

### format
現在はsexp固定です。(S式を返します)
将来、Emacs以外のクライアントに対応する段階でjsonなどを追加する予定です。


# API一覧
## /henkan
ローマ字を仮名漢字に変換します。
次のような変換候補一覧が返ります。(format=sexpの例)
!(("漢字変換" nil "かんじへんかん" j 0)
! ("かんじへんかん" nil "kanjihenkan" h 1)
! ("カンジヘンカン" nil "kanjihenkan" k 2)
! ("かぬんいへにんあん" nil "kanjihenkan" h 3)
! ("カヌンイヘニンアン" nil "kanjihenkan" k 4)
! ("Ｋａｎｊｉｈｅｎｋａｎ" nil "Kanjihenkan" z 5)
! ("Kanjihenkan" nil "Kanjihenkan" l 6))
リストの各要素のフォーマットは下記の通りです。
# 第1要素: 変換結果文字列
"漢字変換"など

# 第2要素: アノテーション
単語の説明などの文字列です。存在しない場合は nil です。

# 第3要素: ユーザー辞書の確定(学習)に使う キー文字列
タイプが 「j」の場合のみ平仮名になります。
それ以外のタイプでは、ローマ字になります。

# 第4要素: 変換候補のタイプ
j n h k z l のうちどれかになります.
 j … 辞書から引いた単語
 n … 辞書から引いた単語(数字混じり)
 h … ひらがな(ローマ字テーブルで変換)
 k … カタカナ(ローマ字テーブルで変換)
 z … 全角アルファベット(入力を全角化した文字列)
 l … 半角アルファベット

# 第5要素: 通しナンバー
0から始まります。

サーバー側でエラーが発生した場合は、エラーメッセージを含んだ文字列が返ります。


以下のパラメータを受け取ります。

### yomi
変換するローマ字文字列。
例:
!yomi=KanjiHenkan

### limit
返却する変換候補の制限数。
ゼロを指定すると無制限になります。
変換候補をリアルタイム表示する用途には 1 を指定すれば、サーバーのCPUリソースと通信量を減らして処理を軽量化することができます。
例:
!limit=1

### method
ローマ字解釈としてnormal(通常ローマ字)かAZIK(AZIK拡張ローマ字)のどちらを優先するかの指定。
※ AZIKは廃止されました。


## /kakutei
指定した単語を第一候補として確定します。(学習)
クライアントで候補選択から、確定の操作が行われた時に呼出してください。
パラメータは以下の通りです。

### key
/henkan機能で返却された変換候補のキー文字列。

例:
「key=かんじへんかん」をutf-8としてURI Encodeしたもの
!key=%e3%81%8b%e3%82%93%e3%81%98%e3%81%b8%e3%82%93%e3%81%8b%e3%82%93

### tango
/henkan機能で返却された変換結果文字列。
例:
「tango=漢字変換」をutf-8としてURI Encodeしたもの
!tango=%e6%bc%a2%e5%ad%97%e5%a4%89%e6%8f%9b


## /register
ユーザー語彙をサーバーに登録します。
以下のパラメータを受け取ります。

### dict
~/.sekka-jisyoの中身をそのまま渡します。
改行も含めて UTF-8としてURI Encodeしたものを送ります。
例:
「dict=へんしゅうきょり /編集距離/\n」をutf-8としてURI Encodeしたもの
!dict=%e3%81%b8%e3%82%93%e3%81%97%e3%82%85%e3%81%86%e3%81%8d%e3%82%87%e3%82%8a%20%2f%e7%b7%a8%e9%9b%86%e8%b7%9d%e9%9b%a2%2f%0a

## /flush
サーバー上のユーザー辞書を全て削除します。ユーザー登録語彙と、学習内容が全て消えます。
パラメータは不要です。


## /googleime
googleimeを使って平仮名から漢字に変換します。
次のような変換候補一覧が返ります。(format=sexpの例)
!("山ガール" "やまガール" "やまがーる" "ヤマガール" "ﾔﾏｶﾞｰﾙ")

サーバー側でエラーが発生した場合は、エラーメッセージを含んだ文字列が返ります。

以下のパラメータを受け取ります。

### yomi
変換するローマ字文字列。
例:
「yomi=やまがーる」をutf-8としてURI Encodeしたもの
!yomi=%e3%82%84%e3%81%be%e3%81%8c%e3%83%bc%e3%82%8b


[以上]
